---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { SITE_CONFIG } from '../data/site-config';
import { DynamicIcon } from '../components/DynamicIcon.jsx';

/**
 * AI 工具页 - 像素级 Bento 还原版 (V1.0)
 * 1. 视觉对齐：沿用首页 V25.0 的 12列网格及 120px 自动行高
 * 2. 交互逻辑：分类过滤按钮采用 Bento 药丸设计
 * 3. 按钮权重：主要按钮 (Open Web) 采用 Peach 高亮，次要按钮 (Demo) 采用白透
 */

const currentPath = Astro.url.pathname;
const isEnglish = currentPath.startsWith('/en');
const lang = isEnglish ? 'en' : 'ja';

// 1. 数据获取
const tools = await getCollection('ai-tools', ({ data }) => data.lang === lang || !data.lang);
const sortedTools = tools.sort((a, b) => Date.parse(b.data.date) - Date.parse(a.data.date));

// 2. 逻辑计算
const categories = ['All', ...new Set(tools.flatMap(tool => tool.data.category))];
const { brand, ui } = SITE_CONFIG;

const getLink = (path: string) => isEnglish ? `/en${path}` : path;
---

<BaseLayout title={`${ui.headings.aiTools[lang]} - ${brand.logo}`} lang={lang}>
    <main class="max-w-6xl mx-auto px-6 pt-4 pb-20 text-left">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-5 md:auto-rows-[120px]">

            <section class="md:col-span-8 md:row-span-2 bento-card bg-[#313244]/15 rounded-[2.5rem] p-8 md:p-10 flex flex-col border border-white/5 relative overflow-hidden group">
                <div class="absolute inset-0 z-0 flex items-center justify-center text-[10rem] font-black italic text-white/[0.02] select-none pointer-events-none uppercase tracking-tighter leading-none -rotate-12">
                    {ui.headings.ai[lang]}
                </div>

                <div class="relative z-10 flex flex-col justify-between h-full">
                    <div>
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-12 h-12 rounded-2xl bg-[#89b4fa]/20 flex items-center justify-center text-[#89b4fa] border border-[#89b4fa]/20">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M12 2v8"/><path d="m4.93 4.93 4.24 4.24"/><path d="M2 12h8"/><path d="m4.93 19.07 4.24-4.24"/><path d="M12 22v-8"/><path d="m19.07 19.07-4.24-4.24"/><path d="M22 12h-8"/><path d="m19.07 4.93-4.24 4.24"/></svg>
                            </div>
                            <h1 class="text-4xl font-black text-white italic tracking-tighter uppercase leading-none">
                                {ui.headings.aiTools[lang]}
                            </h1>
                        </div>
                        <p class="max-w-xl text-white/90 text-sm md:text-base leading-relaxed font-medium italic">
                            {ui.labels.aiToolsIntro[lang]}
                        </p>
                    </div>

                    <div class="flex flex-wrap gap-2 mt-6">
                        {categories.map(cat => (
                                <button
                                        class="filter-btn px-4 py-1.5 bg-white/5 border border-white/10 rounded-full text-[10px] font-black uppercase tracking-widest text-white/60 hover:bg-[#89b4fa]/20 hover:text-[#89b4fa] transition-all"
                                        data-category={cat}
                                >
                                    # {cat === 'All' ? ui.labels.all[lang] : cat}
                                </button>
                        ))}
                    </div>
                </div>
            </section>

            <section class="md:col-span-4 md:row-span-2 bento-card bg-[#313244]/15 rounded-[2.5rem] p-8 border border-white/5 flex flex-col justify-center items-center text-center group">
                <span class="text-[10px] font-black text-[#89b4fa] uppercase tracking-[0.4em] mb-2">Total Arsenal</span>
                <div class="text-7xl font-black italic text-white tracking-tighter mb-1 group-hover:scale-110 transition-transform duration-500">
                    {tools.length}
                </div>
                <div class="h-1 w-12 bg-[#89b4fa]/30 rounded-full"></div>
            </section>

            {sortedTools.map(tool => {
                const cleanSlug = tool.id.replace(/\.md$/, '');
                return (
                        <section class="tool-card md:col-span-6 md:row-span-3 bento-card bg-[#313244]/15 rounded-[2.5rem] border border-white/5 p-8 flex flex-col group relative overflow-hidden" data-category={JSON.stringify(tool.data.category)}>
                            <div class="flex justify-between items-start mb-6">
                                <div class="flex items-center gap-5">
                                    <div class="w-16 h-16 rounded-2xl bg-white/5 flex items-center justify-center text-[#89b4fa] border border-white/10 group-hover:scale-110 group-hover:bg-[#89b4fa]/10 transition-all duration-500">
                                        <DynamicIcon name={tool.data.icon} size={32} client:load />
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-black text-white italic tracking-tighter leading-tight group-hover:text-[#89b4fa] transition-colors">{tool.data.title}</h3>
                                        <div class="flex gap-2 mt-1">
                                            {tool.data.category.map(cat => (
                                                    <span class="text-[9px] font-mono font-bold text-white/30 uppercase tracking-widest">#{cat}</span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <span class="text-[9px] font-mono text-white/20 font-bold uppercase tracking-tighter">{tool.data.date}</span>
                            </div>

                            <p class="text-sm text-white/70 leading-relaxed italic mb-8 flex-grow">
                                {tool.data.description}
                            </p>

                            <div class="grid grid-cols-2 gap-3 mt-auto">
                                <a href={tool.data.url} target="_blank" class="flex items-center justify-center gap-2 py-3 rounded-2xl bg-[#fab387] text-[#1e1e2e] font-black italic text-xs uppercase tracking-tighter hover:scale-[1.02] active:scale-95 transition-all shadow-lg shadow-[#fab387]/10">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
                                    {ui.labels.openWeb[lang]}
                                </a>
                                <a href={getLink(`/ai-tools/${cleanSlug}`)} class="flex items-center justify-center gap-2 py-3 rounded-2xl bg-white/5 border border-white/10 text-white/80 font-black italic text-xs uppercase tracking-tighter hover:bg-white/10 transition-all">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                                    {ui.labels.viewDemo[lang]}
                                </a>
                            </div>
                        </section>
                );
            })}

        </div>
    </main>
</BaseLayout>

<script>
    function initFilters() {
        const btns = document.querySelectorAll('.filter-btn');
        const cards = document.querySelectorAll('.tool-card');

        // 初始激活全部
        btns[0]?.classList.add('bg-[#89b4fa]/20', 'text-[#89b4fa]', 'border-[#89b4fa]/30');

        btns.forEach(btn => {
            btn.addEventListener('click', () => {
                const selectedCat = btn.getAttribute('data-category');

                cards.forEach(card => {
                    const toolCats = JSON.parse(card.getAttribute('data-category') || '[]');
                    const isVisible = selectedCat === 'All' || toolCats.includes(selectedCat);
                    (card as HTMLElement).style.display = isVisible ? 'flex' : 'none';
                });

                // 切换按钮样式
                btns.forEach(b => {
                    b.classList.remove('bg-[#89b4fa]/20', 'text-[#89b4fa]', 'border-[#89b4fa]/30');
                    b.classList.add('bg-white/5', 'text-white/60', 'border-white/10');
                });
                btn.classList.add('bg-[#89b4fa]/20', 'text-[#89b4fa]', 'border-[#89b4fa]/30');
                btn.classList.remove('bg-white/5', 'text-white/60', 'border-white/10');
            });
        });
    }
    initFilters();
    document.addEventListener('astro:page-load', initFilters);
</script>

<style>
    .bento-card { @apply transition-all duration-500; box-shadow: inset 0 1px 1px 0 rgba(255, 255, 255, 0.03); }
    /* 卡片悬停时的光泽感 */
    .bento-card::after {
        content: '';
        @apply absolute inset-0 rounded-[2.5rem] opacity-0 transition-opacity duration-500 pointer-events-none;
        background: radial-gradient(600px circle at var(--mouse-x) var(--mouse-y), rgba(255,255,255,0.06), transparent 40%);
    }
</style>