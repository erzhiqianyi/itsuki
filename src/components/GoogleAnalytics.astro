---
const { id } = Astro.props;
---
<script async src={`https://www.googletagmanager.com/gtag/js?id=${id}`}></script>
<script is:inline define:vars={{ id }}>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', id);

    // 兼容 Astro 5 的 ClientRouter：在每次页面切换后触发上报
    document.addEventListener('astro:page-load', () => {
        gtag('event', 'page_view', {
            page_title: document.title,
            page_location: window.location.href,
            page_path: window.location.pathname
        });
    });
</script>